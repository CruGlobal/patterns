$(document).ready(function(){function t(t){$.ajax({url:e.ministry_details.replace("%d",t),dataType:"jsonp",async:!1,data:{active:1},success:function(t){var a=$(".locator__results").empty();if(t.strategies.length>0){var i=$.map(t.strategies,function(t){return e.ministries[t.strategy]?(t.strategy=e.ministries[t.strategy],t):null}).sort(function(t,a){return t.strategy.localeCompare(a.strategy)});$('<h2 class="mb-"></h2>').text(t.name).appendTo(a);var s=$('<ul class="block-list"></ul>');$.each(i,function(t,a){if(a.contacts.length>0||a.url||a.facebook){var e=$('<li class="mb"></li>').appendTo(s);$('<h3 class="h4  mb--  border-bottom-solid"></h3>').text(a.strategy).appendTo(e)}if(a.url||a.facebook){var i=$('<ul class="block-list  mb--"></ul>');a.facebook&&("http"!==a.facebook.substr(0,4)&&(a.facebook="http://"+a.facebook),$("<li></li>").append($("<a></a>").attr("href",a.facebook).text(a.facebook)).appendTo(i)),a.url&&""!==a.url&&("http://"!==a.url.substr(0,7)&&(a.url="http://"+a.url),$("<li></li>").append($("<a></a>").attr("href",a.url).text(a.url.substr(7))).appendTo(i)),$(i).appendTo(e)}if(a.contacts.length>0){var n=$('<ul class="block-list  contacts"></ul>');$('<li><ul class="grid"><li class="contact__title-name  grid__item  desk--one-third">Name</li><li class="contact__title-name  grid__item  desk--one-third">Email</li><li class="contact__title-name  grid__item  desk--one-third">Phone</li></ul></li>').appendTo(n),$.each(a.contacts,function(t,a){var e=$('<li class="contact__item"></li>'),i=$('<ul class="grid"></ul>'),s=a.preferred+" "+a.last;i.append($('<li class="grid__item  desk--one-third">'+s+"</li>")),i.append(a.email?$('<li class="grid__item  desk--one-third"><a href="mailto:'+a.email+'">'+a.email+"<a></li>"):$('<li class="grid__item  desk--one-third"> </li>')),i.append(a.phone?$('<li class="grid__item  desk--one-third">'+a.phone+"</li>"):$('<li class="grid__item  desk--one-third"></li>')),e.append(i),n.append(e)}),e.append(n)}}),$(s).appendTo(a)}$(s).children().length<=0&&a.empty()}})}function a(){$(".locator__results").text("");var t="",a={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC"};t=a[state],$(".locator__state-results").text(""),$(".locator__state-name").text("Campuses in "+t).removeClass("mb0"),$.getJSON(jsonLink,function(t){$.each(t,function(t,a){$(".locator__state-results").append("<li><a class='ps--  block-link' href='"+a.id+"' name='select'>"+a.name+" <small>("+a.city+", "+a.state+")</small></a></li>")})})}var e={ministry_search:"http://ml.uscm.org/ministries.json?active=true",ministry_details:"http://ml.uscm.org/ministries/%d.json",ministries:{CA:"Catalytic",SC:"Staffed Campus",IE:"Epic",ID:"Destino",II:"Impact",IN:"Nations",WI:"WSN ICS",WS:"WSN Stint",BR:"Bridges",MM:"Military Ministry",AA:"Athletes In Action",GR:"Grad Resource",CL:"Christian Leadership Ministries",KC:"Korean CCC",GK:"Greek",VL:"Valor",OT:"Other",FS:"Campus Field Ministry"}};$(function(){$('.locator input[name="campus-name"]').autocomplete({source:function(t,a){$.ajax({url:e.ministry_search,dataType:"jsonp",async:!1,data:{name:t.term,limit:10},success:function(t){a($.map(t,function(t){return{label:t.name,value:t.name,id:t.id}}))}})},minLength:2,autoFocus:!0,select:function(a,e){$('.locator input[name="campus-id"]').val(e.item.id),$(".locator__state-name").text(""),$(".locator__state-results").text(""),""===$(".locator form").attr("action")?t(e.item.id):($('.locator input[name="campus-name"]').val(e.item.label),$(".locator form").get(0).submit())}}),""!==$('.locator input[name="campus-id"]').val()&&t($('.locator input[name="campus-id"]').val())}),$(".locator__state").change(function(){return state=$(".locator__state :selected").val(),""!==state?(jsonLink="http://ml.uscm.org/ministries.json?state="+state+"&active=true&callback=?",a(),$(".locator__state").prop("selectedIndex",0),!1):($(".locator__state-results").text(""),void $(".locator__state-name").text(""))}),$(document).on("click","a[name=select]",function(a){a.preventDefault();var e=this.getAttribute("href");$(".locator__state-results").text(""),$(".locator__state-name").text(""),t(e)}),$(function(){$(".locator").find("span").remove(),$(".locator").find("ul.ui-autocomplete").addClass("block-list")})});