$(document).ready(function(){function t(t){$.ajax({url:a.ministry_details.replace("%d",t),dataType:"jsonp",async:!1,data:{active:1},success:function(t){var e=$(".js-campus-finder-results").empty();if(t.strategies.length>0){var s=$.map(t.strategies,function(t){return a.ministries[t.strategy]?(t.strategy=a.ministries[t.strategy],t):null}).sort(function(t,e){return t.strategy.localeCompare(e.strategy)});$('<h2 class="mb-"></h2>').text(t.name).appendTo(e);var i=$('<ul class="block-list"></ul>');$.each(s,function(t,e){if(e.contacts.length>0||e.url||e.facebook){var a=$('<li class="mb"></li>').appendTo(i);$('<h3 class="h4 mb--"></h3>').text(e.strategy).appendTo(a)}if(e.url||e.facebook){var s=$('<ul class="nav  social  mb--"></ul>');e.facebook&&$('<li class="accent"></li>').append($('<a class="social__item  icon-facebook"></a>').attr("href",e.facebook)).appendTo(s),e.url&&""!==e.url&&("http://"!==e.url.substr(0,7)&&(e.url="http://"+e.url),$("<li></li>").append($("<a></a>").attr("href",e.url).text(e.url.substr(7))).appendTo(s)),$(s).appendTo(a)}if(e.contacts.length>0){var n=$('<ul class="block-list  contacts"></ul>');$('<li class="contact__item  contact__titles"><ul class="grid"><li class="contact__title-name  grid__item  desk--one-third">Name</li><li class="contact__title-name  grid__item  desk--one-third">Email</li><li class="contact__title-name  grid__item  desk--one-third">Phone</li></ul></li>').appendTo(n),$.each(e.contacts,function(t,e){var a=$('<li class="contact__item"></li>'),s=$('<ul class="grid"></ul>'),i=e.preferred+" "+e.last;s.append($('<li class="grid__item  desk--one-third">'+i+"</li>")),s.append(e.email?$('<li class="grid__item  desk--one-third"><a href="mailto:'+e.email+'">'+e.email+"<a></li>"):$('<li class="grid__item  desk--one-third"> </li>')),s.append(e.phone?$('<li class="grid__item  desk--one-third">'+e.phone+"</li>"):$('<li class="grid__item  desk--one-third"></li>')),a.append(s),n.append(a)}),a.append(n)}}),$(i).appendTo(e)}$(i).children().length<=0&&e.empty()}})}function e(){$(".js-campus-finder-results").text("");var t="",e={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC"};t=e[state],$(".js-state-select-results").text(""),$(".js-state-select-title").text("Campuses in "+t).removeClass("mb0"),$.getJSON(jsonLink,function(t){$.each(t,function(t,e){$(".js-state-select-results").append("<li><a class='ps--  block-link' href='"+e.id+"' name='select'>"+e.name+" <small>("+e.city+", "+e.state+")</small></a></li>")})})}var a={ministry_search:"http://ml.uscm.org/ministries.json?active=true",ministry_details:"http://ml.uscm.org/ministries/%d.json",ministries:{CA:"Catalytic",SC:"Staffed Campus",IE:"Epic",ID:"Destino",II:"Impact",IN:"Nations",WI:"WSN ICS",WS:"WSN Stint",BR:"Bridges",MM:"Military Ministry",AA:"Athletes In Action",GR:"Grad Resource",CL:"Christian Leadership Ministries",KC:"Korean CCC",GK:"Greek",VL:"Valor",OT:"Other",FS:"Campus Field Ministry"}};$(function(){$(".campus-finder input.campus-name").autocomplete({source:function(t,e){$.ajax({url:a.ministry_search,dataType:"jsonp",async:!1,data:{name:t.term,limit:10},success:function(t){e($.map(t,function(t){return{label:t.name,value:t.name,id:t.id}}))}})},minLength:2,autoFocus:!0,select:function(e,a){$('.campus-finder input[name="campus-id"]').val(a.item.id),$(".state-select-title").text(""),$(".state-select-results").text(""),""===$(".campus-finder form").attr("action")?t(a.item.id):($('.campus-finder input[name="campus-name"]').val(a.item.label),$(".campus-finder form").get(0).submit())}}),""!==$('.campus-finder input[name="campus-id"]').val()&&t($('.js-campus-finder input[name="campus-id"]').val())}),$(".state-select").change(function(){return state=$(".state-select :selected").val(),""!==state?(jsonLink="http://ml.uscm.org/ministries.json?state="+state+"&active=true&callback=?",e(),$(".state-select").prop("selectedIndex",0),!1):($(".js-state-select-results").text(""),void $(".js-state-select-title").text(""))}),$(document).on("click","a[name=select]",function(e){e.preventDefault();var a=this.getAttribute("href");$(".js-state-select-results").text(""),$(".js-state-select-title").text(""),t(a)}),$(function(){$(".js-campus-finder").find("span").remove(),$(".js-campus-finder").find("ul.ui-autocomplete").addClass("block-list")})});