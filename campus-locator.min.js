$(document).ready(function(){function e(e){$.ajax({url:cru_campus_finder_l10n.ministry_details.replace("%d",e),dataType:"jsonp",async:!1,data:{active:1},success:function(e){var t=$(".js-campus-finder-results").empty();if(e.strategies.length>0){var a=$.map(e.strategies,function(e){return cru_campus_finder_l10n.ministries[e.strategy]?(e.strategy=cru_campus_finder_l10n.ministries[e.strategy],e):null}).sort(function(e,t){return e.strategy.localeCompare(t.strategy)});$('<h2 class="campus-title"></h2>').text(e.name).appendTo(t);var s=$('<ul class="block-list"></ul>').empty();$.each(a,function(e,a){var s=$('<details><div class="p-"></div></details>');if($('<summary class="strategy-title"></summary>').text(a.strategy).appendTo(s),a.contacts.length>0){var n=$('<table class="contacts  table"><tr><td class="col-head" role=columnheader>Name</td><td class="col-head" role=columnheader>Email</td><td class="col-head" role=columnheader>Phone</td></tr></table>'),r=$("<tr></tr>"),i=$('<td class="col-head row-head" role=columnheader>Name</td>').append(r),l=$('<td class="col-head row-head" role=columnheader>Email</td>').append(r),c=$('<td class="col-head row-head" role=columnheader>Phone</td>').append(r);$.each(a.contacts,function(e,t){var a=$("<tr></tr>"),s=t.preferred+" "+t.last;a.append($('<td class="contact__email">'+s+"</td>")),a.append(t.email?$('<td class="contact__email"><a href="mailto:'+t.email+'">'+t.email+"<a></td>"):$("<td></td>")),a.append(t.phone?$('<td class="contact__phone">'+t.phone+"</td>"):$("<td></td>")),n.append(a)}),r.append(n),s.append(n)}a.url&&""!=a.url&&("http://"!=a.url.substr(0,7)&&(a.url="http://"+a.url),$('<div class="url"><div>').append($("<a></a>").attr("href",a.url).text(a.url.substr(7))).appendTo(s)),a.facebook&&$('<div class="facebook url"><div>').append($('<a class="social__item  icon-facebook"></a>').attr("href",a.facebook)).appendTo(s),(a.contacts.length>0||a.url||a.facebook)&&s.appendTo(t)}),strategy.appendTo(s)}$(".strategy",t).size()<=0&&t.empty()}})}function t(){$(".js-campus-finder-results").text("");var e="",t={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC"};e=t[state],$(".js-state-select-results").text(""),$(".js-state-select-title").text("Campuses in "+e).removeClass("mb0"),$.getJSON(jsonLink,function(e){$.each(e,function(e,t){$(".js-state-select-results").append("<li><a class='ps--  block-link' href='"+t.id+"' name='select'>"+t.name+" <small>("+t.city+", "+t.state+")</small></a></li>")})})}function a(e){$.ajax({url:cru_campus_finder_l10n.ministry_details.replace("%d",e),dataType:"jsonp",data:{active:1},success:function(e){$(".js-state-select-results, .js-state-select-title").text("");var t=$(".js-state-select-results").empty();if(e.strategies.length>0){var a=$.map(e.strategies,function(e){return cru_campus_finder_l10n.ministries[e.strategy]?(e.strategy=cru_campus_finder_l10n.ministries[e.strategy],e):null}).sort(function(e,t){return e.strategy.localeCompare(t.strategy)});$('<h2 class="campus-title"></h2>').text(e.name).appendTo(t),$.each(a,function(e,a){var s=$('<div class="strategy"></div>');if($('<h3 class="h4  strategy-title  mb--"></h4>').text(a.strategy).appendTo(s),a.contacts.length>0){var n=$('<ul class="contacts  mb-"></ul>');$.each(a.contacts,function(e,t){var a=$("<li></li>"),s=t.preferred+" "+t.last;t.email?a.append($("<a></a>").text(s).attr("href","mailto:"+t.email)):a.text(s),t.phone&&a.append($('<span class="phone" style="padding-left:10px;"></span>').text(t.phone)),n.append(a)}),s.append(n)}a.url&&""!=a.url&&("http://"!=a.url.substr(0,7)&&(a.url="http://"+a.url),$('<div class="url"><div>').append($("<a></a>").attr("href",a.url).text(a.url)).appendTo(s)),a.facebook&&$('<div class="facebook url"><div>').append($("<a></a>").attr("href",a.facebook).text(a.facebook)).appendTo(s),(a.contacts.length>0||a.url||a.facebook)&&s.appendTo(t)})}$(".strategy",t).size()<=0&&t.empty()}})}$(function(){$(".campus-finder input.campus-name").autocomplete({source:function(e,t){$.ajax({url:cru_campus_finder_l10n.ministry_search,dataType:"jsonp",async:!1,data:{name:e.term,limit:10},success:function(e){t($.map(e,function(e){return{label:e.name,value:e.name,id:e.id}}))}})},minLength:2,autoFocus:!0,select:function(t,a){$('.campus-finder input[name="campus-id"]').val(a.item.id),$(".state-select-title").text(""),$(".state-select-results").text(""),""==$(".campus-finder form").attr("action")?e(a.item.id):($('.campus-finder input[name="campus-name"]').val(a.item.label),$(".campus-finder form").get(0).submit())}}),$(".campus-finder input.button").click(function(){$(".campus-finder input.campus-name").autocomplete("search")}),""!=$('.campus-finder input[name="campus-id"]').val()&&e($('.js-campus-finder input[name="campus-id"]').val())}),$(".state-select").change(function(){return state=$(".state-select :selected").val(),""!=state?(jsonLink="http://ml.uscm.org/ministries.json?state="+state+"&active=true&callback=?",t(),$(".state-select").prop("selectedIndex",0),!1):($(".js-state-select-results").text(""),void $(".js-state-select-title").text(""))}),$(document).on("click","a[name=select]",function(e){e.preventDefault();var t=this.getAttribute("href");a(t)}),$(function(){$(".js-campus-finder").find("span").remove()})});