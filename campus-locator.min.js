$(document).ready(function(){function t(t){$.ajax({url:cru_campus_finder_l10n.ministry_details.replace("%d",t),dataType:"jsonp",async:!1,data:{active:1},success:function(t){var e=$(".campus-finder-results").empty();if(t.strategies.length>0){var a=$.map(t.strategies,function(t){return cru_campus_finder_l10n.ministries[t.strategy]?(t.strategy=cru_campus_finder_l10n.ministries[t.strategy],t):null}).sort(function(t,e){return t.strategy.localeCompare(e.strategy)});$('<h1 class="campus-title"></h1>').text(t.name).appendTo(e),$.each(a,function(t,a){var s=$('<div class="strategy"></div>');if($('<div class="strategy-title"></div>').text(a.strategy).appendTo(s),a.contacts.length>0){var n=$('<ul class="contacts"></ul>');$.each(a.contacts,function(t,e){var a=$("<li></li>"),s=e.preferred+" "+e.last;e.email?a.append($("<a></a>").text(s).attr("href","mailto:"+e.email)):a.text(s),e.phone&&a.append($('<span class="phone"></span>').text(e.phone)),n.append(a)}),s.append(n)}a.url&&""!=a.url&&("http://"!=a.url.substr(0,7)&&(a.url="http://"+a.url),$('<div class="url"><div>').append($("<a></a>").attr("href",a.url).text(a.url)).appendTo(s)),a.facebook&&$('<div class="facebook url"><div>').append($("<a></a>").attr("href",a.facebook).text(a.facebook)).appendTo(s),(a.contacts.length>0||a.url||a.facebook)&&s.appendTo(e)})}$(".strategy",e).size()<=0&&e.empty()}})}function e(){$(".campus-finder-results").text("");var t="",e={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC"};t=e[state],$(".state-select-results").text(""),$(".state-select-title").text("Campuses in "+t),$.getJSON(jsonLink,function(t){$.each(t,function(t,e){$(".state-select-results").append("<a href='"+e.id+"' name='select'>"+e.name+"</a> <small>("+e.city+", "+e.state+")</small></br>")})})}function a(t){$.ajax({url:cru_campus_finder_l10n.ministry_details.replace("%d",t),dataType:"jsonp",data:{active:1},success:function(t){$(".state-select-results, .state-select-title").text("");var e=$(".state-select-results").empty();if(t.strategies.length>0){var a=$.map(t.strategies,function(t){return cru_campus_finder_l10n.ministries[t.strategy]?(t.strategy=cru_campus_finder_l10n.ministries[t.strategy],t):null}).sort(function(t,e){return t.strategy.localeCompare(e.strategy)});$('<h1 class="campus-title"></h1>').text(t.name).appendTo(e),$.each(a,function(t,a){var s=$('<div class="strategy"></div>');if($('<div class="strategy-title"></div>').text(a.strategy).appendTo(s),a.contacts.length>0){var n=$('<ul class="contacts"></ul>');$.each(a.contacts,function(t,e){var a=$("<li></li>"),s=e.preferred+" "+e.last;e.email?a.append($("<a></a>").text(s).attr("href","mailto:"+e.email)):a.text(s),e.phone&&a.append($('<span class="phone" style="padding-left:10px;"></span>').text(e.phone)),n.append(a)}),s.append(n)}a.url&&""!=a.url&&("http://"!=a.url.substr(0,7)&&(a.url="http://"+a.url),$('<div class="url"><div>').append($("<a></a>").attr("href",a.url).text(a.url)).appendTo(s)),a.facebook&&$('<div class="facebook url"><div>').append($("<a></a>").attr("href",a.facebook).text(a.facebook)).appendTo(s),(a.contacts.length>0||a.url||a.facebook)&&s.appendTo(e)})}$(".strategy",e).size()<=0&&e.empty()}})}$(function(){$(".js-campus-name").autocomplete({source:function(t,e){$.ajax({url:cru_campus_finder_l10n.ministry_search,dataType:"jsonp",async:!1,data:{name:t.term,limit:10},success:function(t){e($.map(t,function(t){return{label:t.name,value:t.name,id:t.id}}))}})},minLength:2,autoFocus:!0,select:function(t,e){$(".js-campus-name").val(e.item.id),$(".state-select-title").text(""),$(".state-select-results").text("")}}),$(".campus-finder input.button").click(function(){$(".campus-finder input.campus-name").autocomplete("search")}),""!=$('.campus-finder input[name="campus-id"]').val()&&t($('.campus-finder input[name="campus-id"]').val())}),$(".state-select").change(function(){return state=$(".state-select :selected").val(),""!=state?(jsonLink="http://ml.uscm.org/ministries.json?state="+state+"&active=true&callback=?",e(),$(".state-select").prop("selectedIndex",0),!1):($(".state-select-results").text(""),void $(".state-select-title").text(""))}),$(document).on("click","a[name=select]",function(t){t.preventDefault();var e=this.getAttribute("href");a(e)})});