$(document).ready(function(){function e(e){$.ajax({url:cru_campus_finder_l10n.ministry_details.replace("%d",e),dataType:"jsonp",async:!1,data:{active:1},success:function(e){var t=$(".js-campus-finder-results").empty();if(e.strategies.length>0){var a=$.map(e.strategies,function(e){return cru_campus_finder_l10n.ministries[e.strategy]?(e.strategy=cru_campus_finder_l10n.ministries[e.strategy],e):null}).sort(function(e,t){return e.strategy.localeCompare(t.strategy)});$('<h2 class="mb-"></h2>').text(e.name).appendTo(t);var s=$('<ul class="block-list"></ul>');$.each(a,function(e,t){if(t.contacts.length>0||t.url||t.facebook){var a=$("<li></li>").appendTo(s);$('<h3 class="h4 mb-"></h3>').text(t.strategy).appendTo(a)}if(t.url||t.facebook){var i=$('<ul class="nav  social  mb-"></ul>');t.facebook&&$('<li class="accent"></li>').append($('<a class="social__item  icon-facebook"></a>').attr("href",t.facebook)).appendTo(i),t.url&&""!==t.url&&("http://"!==t.url.substr(0,7)&&(t.url="http://"+t.url),$("<li></li>").append($("<a></a>").attr("href",t.url).text(t.url.substr(7))).appendTo(i)),$(i).appendTo(a)}if(t.contacts.length>0){var n=$('<ul class="block-list  contacts"></ul>');$('<li class="contact__item  contact__titles"><ul class="grid"><li class="contact__name  grid__item  desk--one-third">Name</li><li class="contact__email  grid__item  desk--one-third">Email</li><li class="contact__phone  grid__item  desk--one-third">Phone</li></ul></li>').appendTo(n),$.each(t.contacts,function(e,t){var a=$('<li class="contact__item"></li>'),s=$('<ul class="grid"></ul>'),i=t.preferred+" "+t.last;s.append($('<li class="contact__name  grid__item  desk--one-third">'+i+"</li>")),s.append(t.email?$('<li class="contact__email  grid__item  desk--one-third"><a href="mailto:'+t.email+'">'+t.email+"<a></li>"):$('<li class="contact__email  grid__item  desk--one-third"> </li>')),s.append(t.phone?$('<li class="contact__phone  grid__item  desk--one-third">'+t.phone+"</li>"):$('<li class="contact__phone  grid__item  desk--one-third"></li>')),a.append(s),n.append(a)}),a.append(n)}}),$(s).appendTo(t)}$(s).children().length<=0&&t.empty()}})}function t(){$(".js-campus-finder-results").text("");var e="",t={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"Washington DC"};e=t[state],$(".js-state-select-results").text(""),$(".js-state-select-title").text("Campuses in "+e).removeClass("mb0"),$.getJSON(jsonLink,function(e){$.each(e,function(e,t){$(".js-state-select-results").append("<li><a class='ps--  block-link' href='"+t.id+"' name='select'>"+t.name+" <small>("+t.city+", "+t.state+")</small></a></li>")})})}$(function(){$(".campus-finder input.campus-name").autocomplete({source:function(e,t){$.ajax({url:cru_campus_finder_l10n.ministry_search,dataType:"jsonp",async:!1,data:{name:e.term,limit:10},success:function(e){t($.map(e,function(e){return{label:e.name,value:e.name,id:e.id}}))}})},minLength:2,autoFocus:!0,select:function(t,a){$('.campus-finder input[name="campus-id"]').val(a.item.id),$(".state-select-title").text(""),$(".state-select-results").text(""),""===$(".campus-finder form").attr("action")?e(a.item.id):($('.campus-finder input[name="campus-name"]').val(a.item.label),$(".campus-finder form").get(0).submit())}}),""!==$('.campus-finder input[name="campus-id"]').val()&&e($('.js-campus-finder input[name="campus-id"]').val())}),$(".state-select").change(function(){return state=$(".state-select :selected").val(),""!==state?(jsonLink="http://ml.uscm.org/ministries.json?state="+state+"&active=true&callback=?",t(),$(".state-select").prop("selectedIndex",0),!1):($(".js-state-select-results").text(""),void $(".js-state-select-title").text(""))}),$(document).on("click","a[name=select]",function(t){t.preventDefault();var a=this.getAttribute("href");$(".js-state-select-results").text(""),$(".js-state-select-title").text(""),e(a)}),$(function(){$(".js-campus-finder").find("span").remove()})});